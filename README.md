# CXR Report Generator

## 설치 및 실행 방법

> **참고:** Node.js가 먼저 설치되어 있어야 합니다.

### 프로젝트 클론

```bash
git clone https://github.com/diuyuy/CXR-Report-Generator.git
cd CXR-Report-Generator
```

### pnpm 설치

```bash
npm i -g pnpm@latest
```

### node_modules 설치

```bash
pnpm install
```

### 프로젝트 빌드

```bash
pnpm build
```

### 애플리케이션 실행

```bash
pnpm start
```

## 상태 관리 및 컴포넌트 구조

### 서버 상태 관리

API를 통해 받아오는 비동기 데이터인 서버 상태는 **TanStack Query** 라이브러리를 사용하여 관리했습니다. **TanStack Query**가 데이터 캐싱, 리페칭(refetching), 로딩 및 에러처리, 그리고 무한 스크롤 기능들을 쉽게 구현할 수 있게 해줘서 이를 사용했습니다.

### 클라이언트 상태 관리

클라이언트의 상태는 기본적으로 `useState`를 사용해서 관리했고, 우측 패널에서 이미지를 채팅 입력창으로 로드하는 기능의 경우 **zustand**를 사용해서 해당 이미지들을 관리했습니다. 우측 패널과 채팅 입력창은 컴포넌트 트리가 분리되어 있어 `props`로 상태를 전달하기 어려운 구조였습니다. 이 문제를 해결하기 위해 선택한 이미지들을 전역 상태로 관리했고, **Redux**와 같은 라이브러리에 비해 보일러플레이트가 적고 간편하게 전역 상태를 관리할 수 있는 **zustand**를 채택했습니다.

### 컴포넌트 구조

본 프로젝트는 **Next.js**를 사용해서 개발해서, **Next.js의 App Router**가 제공하는 파일 시스템 기반의 라우팅 및 레이아웃 컨벤션을 활용하여 설계되었습니다. 본 프로젝트의 소스 코드 파일들의 폴더링 구조는 다음과 같습니다:

```plain text
cxr-report-generator/
├─ app/
│  ├─ (main)/
│  │  ├─ chats/
│  │  │  ├─ [chatId]/
│  │  │  ├─ components/
│  │  │  ├─ hooks/
│  │  ├─ reports/
│  │  │  ├─ [reportId]/
│  │  │  ├─ components/
│  │  │  ├─ hooks/
│  │  ├─ components/
│  │  ├─ hooks/
│  │  ├─ types/
│  ├─ api/
│  ├─ pdfs/
├─ components/
├─ constants/
├─ hooks/
├─ lib/
├─ providers/
├─ public/
├─ stores/
├─ middleware.ts
```

`components`: 전역적으로 사용되는 공통 컴포넌트들을 모아놓은 폴더입니다. 각 라우트별 전용 컴포넌트들은 해당 라우트 폴더 내에 별도로 구성했습니다.

`hooks`: 전역적으로 사용되는 커스텀 훅들을 모아놓은 폴더입니다. 각 라우트별 전용 훅들은 해당 라우트 폴더 내에 별도로 구성했습니다.

`constants`: 애플리케이션에서 사용되는 주요 상수들을 모아놓은 폴더입니다.

`lib`: 유틸리티 함수들과 API 호출 함수들을 모아놓은 폴더입니다.

`providers`: 외부 라이브러리에서 제공하는 `ContextProvider`를 모아놓은 폴더입니다.

`public`: 이미지, 폰트 등 정적 파일들을 모아놓은 폴더입니다.

`stores`: **zustand**의 `store`들을 모아놓은 폴더입니다.

`middleware.ts`: **Next.js**에서 제공하는 미들웨어 함수입니다.

## UI 주요 화면 설명 및 UI / UX 고려사항

### 기본 채팅 화면

![alt text](/readme/screen1.png)

**1. 이미지 로드 기능:**
우측 패널에서 환자의 이미지를 로드할 시 바로 채팅 입력창에 해당 이미지들이 로드되게 구현했습니다.또한 로드된 이미지 우상단에 x 버튼을 만들어 이미지 로드 취소 기능을 구현했습니다.

**2. 채팅 기록 및 리포트 기록 무한 스크롤 기능:**
좌측 패널의 기록 조회 기능은 잠재적으로 데이터 양이 매우 많아질 수 있다는 점을 고려하여 무한 스크롤 방식으로 구현했습니다.

- 페이지네이션 방식의 단점인 '다음' 버튼 클릭의 번거로움을 없애고, 사용자가 스크롤만으로 과거 기록까지 자연스럽게 탐색할 수 있도록 하여 직관적이고 편리한 사용성을 제공했습니다.

- 한 번에 모든 기록을 불러오는 대신, 사용자의 스크롤 위치에 따라 필요한 만큼의 데이터만 동적으로 요청하는 방식으로 초기 로딩 속도를 단축하고 불필요한 네트워크 트래픽을 줄였습니다.

### 리포트 패널

![alt text](/readme/report-screen.png)

리포트 보기 및 PDF 생성 기능을 구현했습니다. **Puppeteer** 라이브러리를 사용해서 구현했으며, 좌측 패널에서 보여지는 리포트와 최대한 화면이 비슷하게 PDF 파일이 생성되게끔 구현했습니다.

### 우측 패널 환자 검색 기능

![alt text](/readme/search-patients.png)

`debounce`를 사용한 환자 검색 기능을 구현했습니다. 사용자가 검색창에 입력하는 동안 발생하는 모든 키 입력마다 API를 호출하는 대신, 입력이 끝난 후에만 API 요청을 보내 불필요한 네트워크 요청을 최소화하고 서버 부하를 줄였습니다.

## 확장 아이디어

**1. 이미지 원본 보기 및 확대 기능:**

![alt text](/readme/image-magnify.png)

환자의 이미지를 더 자세히 볼 수 있는 기능이 필요하다고 판단하여 로드된 이미지 클릭 시 해당 이미지의 원본 크기 보기 및 확대 기능을 구현했습니다.

**2. 채팅 및 리포트 기록 검색 기능:**
향후 기능 확장으로 좌측 패널에 있는 채팅과 리포트 기록을 검색을 통해 조회하는 기능을 추가하여, 사용자가 과거 데이터를 쉽게 찾을 수 있도록 사용성을 개선할 수 있습니다.
